(()=>{function t(t,e,n,i){Object.defineProperty(t,e,{get:n,set:i,enumerable:!0,configurable:!0})}var e={};Object.defineProperty(e,"__esModule",{value:!0});var n={};t(n,"create",(()=>o)),t(n,"fromMat4",(()=>a)),t(n,"clone",(()=>c)),t(n,"copy",(()=>h)),t(n,"fromValues",(()=>u)),t(n,"set",(()=>l)),t(n,"identity",(()=>p)),t(n,"transpose",(()=>d)),t(n,"invert",(()=>f)),t(n,"adjoint",(()=>m)),t(n,"determinant",(()=>g)),t(n,"multiply",(()=>v)),t(n,"translate",(()=>x)),t(n,"rotate",(()=>M)),t(n,"scale",(()=>y)),t(n,"fromTranslation",(()=>b)),t(n,"fromRotation",(()=>w)),t(n,"fromScaling",(()=>S)),t(n,"fromMat2d",(()=>_)),t(n,"fromQuat",(()=>R)),t(n,"normalFromMat4",(()=>E)),t(n,"projection",(()=>T)),t(n,"str",(()=>C)),t(n,"frob",(()=>V)),t(n,"add",(()=>P)),t(n,"subtract",(()=>L)),t(n,"multiplyScalar",(()=>z)),t(n,"multiplyScalarAndAdd",(()=>X)),t(n,"exactEquals",(()=>q)),t(n,"equals",(()=>A)),t(n,"mul",(()=>D)),t(n,"sub",(()=>I));var i=1e-6,r="undefined"!=typeof Float32Array?Float32Array:Array,s=Math.random;Math.PI;function o(){var t=new r(9);return r!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function c(t){var e=new r(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function h(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function u(t,e,n,i,s,o,a,c,h){var u=new r(9);return u[0]=t,u[1]=e,u[2]=n,u[3]=i,u[4]=s,u[5]=o,u[6]=a,u[7]=c,u[8]=h,u}function l(t,e,n,i,r,s,o,a,c,h){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=s,t[5]=o,t[6]=a,t[7]=c,t[8]=h,t}function p(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function d(t,e){if(t===e){var n=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function f(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],h=e[7],u=e[8],l=u*o-a*h,p=-u*s+a*c,d=h*s-o*c,f=n*l+i*p+r*d;return f?(f=1/f,t[0]=l*f,t[1]=(-u*i+r*h)*f,t[2]=(a*i-r*o)*f,t[3]=p*f,t[4]=(u*n-r*c)*f,t[5]=(-a*n+r*s)*f,t[6]=d*f,t[7]=(-h*n+i*c)*f,t[8]=(o*n-i*s)*f,t):null}function m(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],h=e[7],u=e[8];return t[0]=o*u-a*h,t[1]=r*h-i*u,t[2]=i*a-r*o,t[3]=a*c-s*u,t[4]=n*u-r*c,t[5]=r*s-n*a,t[6]=s*h-o*c,t[7]=i*c-n*h,t[8]=n*o-i*s,t}function g(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],c=t[7],h=t[8];return e*(h*s-o*c)+n*(-h*r+o*a)+i*(c*r-s*a)}function v(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],c=e[5],h=e[6],u=e[7],l=e[8],p=n[0],d=n[1],f=n[2],m=n[3],g=n[4],v=n[5],x=n[6],M=n[7],y=n[8];return t[0]=p*i+d*o+f*h,t[1]=p*r+d*a+f*u,t[2]=p*s+d*c+f*l,t[3]=m*i+g*o+v*h,t[4]=m*r+g*a+v*u,t[5]=m*s+g*c+v*l,t[6]=x*i+M*o+y*h,t[7]=x*r+M*a+y*u,t[8]=x*s+M*c+y*l,t}function x(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],c=e[5],h=e[6],u=e[7],l=e[8],p=n[0],d=n[1];return t[0]=i,t[1]=r,t[2]=s,t[3]=o,t[4]=a,t[5]=c,t[6]=p*i+d*o+h,t[7]=p*r+d*a+u,t[8]=p*s+d*c+l,t}function M(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],c=e[5],h=e[6],u=e[7],l=e[8],p=Math.sin(n),d=Math.cos(n);return t[0]=d*i+p*o,t[1]=d*r+p*a,t[2]=d*s+p*c,t[3]=d*o-p*i,t[4]=d*a-p*r,t[5]=d*c-p*s,t[6]=h,t[7]=u,t[8]=l,t}function y(t,e,n){var i=n[0],r=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function b(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function w(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function S(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function _(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function R(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n+n,a=i+i,c=r+r,h=n*o,u=i*o,l=i*a,p=r*o,d=r*a,f=r*c,m=s*o,g=s*a,v=s*c;return t[0]=1-l-f,t[3]=u-v,t[6]=p+g,t[1]=u+v,t[4]=1-h-f,t[7]=d-m,t[2]=p-g,t[5]=d+m,t[8]=1-h-l,t}function E(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],c=e[6],h=e[7],u=e[8],l=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],v=e[15],x=n*a-i*o,M=n*c-r*o,y=n*h-s*o,b=i*c-r*a,w=i*h-s*a,S=r*h-s*c,_=u*m-l*f,R=u*g-p*f,E=u*v-d*f,T=l*g-p*m,C=l*v-d*m,V=p*v-d*g,P=x*V-M*C+y*T+b*E-w*R+S*_;return P?(P=1/P,t[0]=(a*V-c*C+h*T)*P,t[1]=(c*E-o*V-h*R)*P,t[2]=(o*C-a*E+h*_)*P,t[3]=(r*C-i*V-s*T)*P,t[4]=(n*V-r*E+s*R)*P,t[5]=(i*E-n*C-s*_)*P,t[6]=(m*S-g*w+v*b)*P,t[7]=(g*y-f*S-v*M)*P,t[8]=(f*w-m*y+v*x)*P,t):null}function T(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function C(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function V(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function P(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function L(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function z(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function X(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t}function q(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function A(t,e){var n=t[0],r=t[1],s=t[2],o=t[3],a=t[4],c=t[5],h=t[6],u=t[7],l=t[8],p=e[0],d=e[1],f=e[2],m=e[3],g=e[4],v=e[5],x=e[6],M=e[7],y=e[8];return Math.abs(n-p)<=i*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(r-d)<=i*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(s-f)<=i*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(o-m)<=i*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(a-g)<=i*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(c-v)<=i*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(h-x)<=i*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(u-M)<=i*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(l-y)<=i*Math.max(1,Math.abs(l),Math.abs(y))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var D=v,I=L,F={};t(F,"create",(()=>It)),t(F,"identity",(()=>Ft)),t(F,"setAxisAngle",(()=>kt)),t(F,"getAxisAngle",(()=>$t)),t(F,"getAngle",(()=>Bt)),t(F,"dot",(()=>ge)),t(F,"multiply",(()=>Ut)),t(F,"rotateX",(()=>Ot)),t(F,"rotateY",(()=>Ht)),t(F,"rotateZ",(()=>Gt)),t(F,"calculateW",(()=>Yt)),t(F,"exp",(()=>jt)),t(F,"ln",(()=>Nt)),t(F,"pow",(()=>Wt)),t(F,"scale",(()=>me)),t(F,"slerp",(()=>Kt)),t(F,"random",(()=>Jt)),t(F,"invert",(()=>Qt)),t(F,"conjugate",(()=>Zt)),t(F,"fromMat3",(()=>te)),t(F,"fromEuler",(()=>ee)),t(F,"str",(()=>ne)),t(F,"clone",(()=>he)),t(F,"fromValues",(()=>ue)),t(F,"copy",(()=>le)),t(F,"set",(()=>pe)),t(F,"add",(()=>de)),t(F,"mul",(()=>fe)),t(F,"lerp",(()=>ve)),t(F,"length",(()=>xe)),t(F,"len",(()=>Me)),t(F,"squaredLength",(()=>ye)),t(F,"sqrLen",(()=>be)),t(F,"normalize",(()=>we)),t(F,"exactEquals",(()=>Se)),t(F,"equals",(()=>_e)),t(F,"rotationTo",(()=>Re)),t(F,"sqlerp",(()=>Ee)),t(F,"setAxes",(()=>Te));var k={};function $(){var t=new r(3);return r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function B(t){var e=new r(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function U(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function O(t,e,n){var i=new r(3);return i[0]=t,i[1]=e,i[2]=n,i}function H(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function G(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function Y(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function j(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function N(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function W(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function K(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function J(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function Q(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function Z(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function tt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function et(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function nt(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t}function it(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return Math.hypot(n,i,r)}function rt(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return n*n+i*i+r*r}function st(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function ot(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function at(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function ct(t,e){var n=e[0],i=e[1],r=e[2],s=n*n+i*i+r*r;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function ht(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ut(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],c=n[2];return t[0]=r*c-s*a,t[1]=s*o-i*c,t[2]=i*a-r*o,t}function lt(t,e,n,i){var r=e[0],s=e[1],o=e[2];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t[2]=o+i*(n[2]-o),t}function pt(t,e,n,i,r,s){var o=s*s,a=o*(2*s-3)+1,c=o*(s-2)+s,h=o*(s-1),u=o*(3-2*s);return t[0]=e[0]*a+n[0]*c+i[0]*h+r[0]*u,t[1]=e[1]*a+n[1]*c+i[1]*h+r[1]*u,t[2]=e[2]*a+n[2]*c+i[2]*h+r[2]*u,t}function dt(t,e,n,i,r,s){var o=1-s,a=o*o,c=s*s,h=a*o,u=3*s*a,l=3*c*o,p=c*s;return t[0]=e[0]*h+n[0]*u+i[0]*l+r[0]*p,t[1]=e[1]*h+n[1]*u+i[1]*l+r[1]*p,t[2]=e[2]*h+n[2]*u+i[2]*l+r[2]*p,t}function ft(t,e){e=e||1;var n=2*s()*Math.PI,i=2*s()-1,r=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*r,t[1]=Math.sin(n)*r,t[2]=i*e,t}function mt(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/o,t[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/o,t[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/o,t}function gt(t,e,n){var i=e[0],r=e[1],s=e[2];return t[0]=i*n[0]+r*n[3]+s*n[6],t[1]=i*n[1]+r*n[4]+s*n[7],t[2]=i*n[2]+r*n[5]+s*n[8],t}function vt(t,e,n){var i=n[0],r=n[1],s=n[2],o=n[3],a=e[0],c=e[1],h=e[2],u=r*h-s*c,l=s*a-i*h,p=i*c-r*a,d=r*p-s*l,f=s*u-i*p,m=i*l-r*u,g=2*o;return u*=g,l*=g,p*=g,d*=2,f*=2,m*=2,t[0]=a+u+d,t[1]=c+l+f,t[2]=h+p+m,t}function xt(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function Mt(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function yt(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function bt(t,e){var n=t[0],i=t[1],r=t[2],s=e[0],o=e[1],a=e[2],c=Math.sqrt(n*n+i*i+r*r)*Math.sqrt(s*s+o*o+a*a),h=c&&ht(t,e)/c;return Math.acos(Math.min(Math.max(h,-1),1))}function wt(t){return t[0]=0,t[1]=0,t[2]=0,t}function St(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function _t(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Rt(t,e){var n=t[0],r=t[1],s=t[2],o=e[0],a=e[1],c=e[2];return Math.abs(n-o)<=i*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=i*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-c)<=i*Math.max(1,Math.abs(s),Math.abs(c))}t(k,"create",(()=>$)),t(k,"clone",(()=>B)),t(k,"length",(()=>U)),t(k,"fromValues",(()=>O)),t(k,"copy",(()=>H)),t(k,"set",(()=>G)),t(k,"add",(()=>Y)),t(k,"subtract",(()=>j)),t(k,"multiply",(()=>N)),t(k,"divide",(()=>W)),t(k,"ceil",(()=>K)),t(k,"floor",(()=>J)),t(k,"min",(()=>Q)),t(k,"max",(()=>Z)),t(k,"round",(()=>tt)),t(k,"scale",(()=>et)),t(k,"scaleAndAdd",(()=>nt)),t(k,"distance",(()=>it)),t(k,"squaredDistance",(()=>rt)),t(k,"squaredLength",(()=>st)),t(k,"negate",(()=>ot)),t(k,"inverse",(()=>at)),t(k,"normalize",(()=>ct)),t(k,"dot",(()=>ht)),t(k,"cross",(()=>ut)),t(k,"lerp",(()=>lt)),t(k,"hermite",(()=>pt)),t(k,"bezier",(()=>dt)),t(k,"random",(()=>ft)),t(k,"transformMat4",(()=>mt)),t(k,"transformMat3",(()=>gt)),t(k,"transformQuat",(()=>vt)),t(k,"rotateX",(()=>xt)),t(k,"rotateY",(()=>Mt)),t(k,"rotateZ",(()=>yt)),t(k,"angle",(()=>bt)),t(k,"zero",(()=>wt)),t(k,"str",(()=>St)),t(k,"exactEquals",(()=>_t)),t(k,"equals",(()=>Rt)),t(k,"sub",(()=>Tt)),t(k,"mul",(()=>Ct)),t(k,"div",(()=>Vt)),t(k,"dist",(()=>Pt)),t(k,"sqrDist",(()=>Lt)),t(k,"len",(()=>zt)),t(k,"sqrLen",(()=>Xt)),t(k,"forEach",(()=>qt));var Et,Tt=j,Ct=N,Vt=W,Pt=it,Lt=rt,zt=U,Xt=st,qt=(Et=$(),function(t,e,n,i,r,s){var o,a;for(e||(e=3),n||(n=0),a=i?Math.min(i*e+n,t.length):t.length,o=n;o<a;o+=e)Et[0]=t[o],Et[1]=t[o+1],Et[2]=t[o+2],r(Et,Et,s),t[o]=Et[0],t[o+1]=Et[1],t[o+2]=Et[2];return t});function At(t){var e=t[0],n=t[1],i=t[2],r=t[3];return Math.hypot(e,n,i,r)}function Dt(t){var e=t[0],n=t[1],i=t[2],r=t[3];return e*e+n*n+i*i+r*r}!function(){var t,e=(t=new r(4),r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();function It(){var t=new r(4);return r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ft(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function kt(t,e,n){n*=.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function $t(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return r>i?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function Bt(t,e){var n=ge(t,e);return Math.acos(2*n*n-1)}function Ut(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=n[0],c=n[1],h=n[2],u=n[3];return t[0]=i*u+o*a+r*h-s*c,t[1]=r*u+o*c+s*a-i*h,t[2]=s*u+o*h+i*c-r*a,t[3]=o*u-i*a-r*c-s*h,t}function Ot(t,e,n){n*=.5;var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=i*c+o*a,t[1]=r*c+s*a,t[2]=s*c-r*a,t[3]=o*c-i*a,t}function Ht(t,e,n){n*=.5;var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=i*c-s*a,t[1]=r*c+o*a,t[2]=s*c+i*a,t[3]=o*c-r*a,t}function Gt(t,e,n){n*=.5;var i=e[0],r=e[1],s=e[2],o=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=i*c+r*a,t[1]=r*c-i*a,t[2]=s*c+o*a,t[3]=o*c-s*a,t}function Yt(t,e){var n=e[0],i=e[1],r=e[2];return t[0]=n,t[1]=i,t[2]=r,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),t}function jt(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=Math.sqrt(n*n+i*i+r*r),a=Math.exp(s),c=o>0?a*Math.sin(o)/o:0;return t[0]=n*c,t[1]=i*c,t[2]=r*c,t[3]=a*Math.cos(o),t}function Nt(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=Math.sqrt(n*n+i*i+r*r),a=o>0?Math.atan2(o,s)/o:0;return t[0]=n*a,t[1]=i*a,t[2]=r*a,t[3]=.5*Math.log(n*n+i*i+r*r+s*s),t}function Wt(t,e,n){return Nt(t,e),me(t,t,n),jt(t,t),t}function Kt(t,e,n,r){var s,o,a,c,h,u=e[0],l=e[1],p=e[2],d=e[3],f=n[0],m=n[1],g=n[2],v=n[3];return(o=u*f+l*m+p*g+d*v)<0&&(o=-o,f=-f,m=-m,g=-g,v=-v),1-o>i?(s=Math.acos(o),a=Math.sin(s),c=Math.sin((1-r)*s)/a,h=Math.sin(r*s)/a):(c=1-r,h=r),t[0]=c*u+h*f,t[1]=c*l+h*m,t[2]=c*p+h*g,t[3]=c*d+h*v,t}function Jt(t){var e=s(),n=s(),i=s(),r=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=r*Math.sin(2*Math.PI*n),t[1]=r*Math.cos(2*Math.PI*n),t[2]=o*Math.sin(2*Math.PI*i),t[3]=o*Math.cos(2*Math.PI*i),t}function Qt(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n*n+i*i+r*r+s*s,a=o?1/o:0;return t[0]=-n*a,t[1]=-i*a,t[2]=-r*a,t[3]=s*a,t}function Zt(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function te(t,e){var n,i=e[0]+e[4]+e[8];if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var s=(r+1)%3,o=(r+2)%3;n=Math.sqrt(e[3*r+r]-e[3*s+s]-e[3*o+o]+1),t[r]=.5*n,n=.5/n,t[3]=(e[3*s+o]-e[3*o+s])*n,t[s]=(e[3*s+r]+e[3*r+s])*n,t[o]=(e[3*o+r]+e[3*r+o])*n}return t}function ee(t,e,n,i){var r=.5*Math.PI/180;e*=r,n*=r,i*=r;var s=Math.sin(e),o=Math.cos(e),a=Math.sin(n),c=Math.cos(n),h=Math.sin(i),u=Math.cos(i);return t[0]=s*c*u-o*a*h,t[1]=o*a*u+s*c*h,t[2]=o*c*h-s*a*u,t[3]=o*c*u+s*a*h,t}function ne(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var ie,re,se,oe,ae,ce,he=function(t){var e=new r(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ue=function(t,e,n,i){var s=new r(4);return s[0]=t,s[1]=e,s[2]=n,s[3]=i,s},le=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},pe=function(t,e,n,i,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t},de=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},fe=Ut,me=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},ge=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},ve=function(t,e,n,i){var r=e[0],s=e[1],o=e[2],a=e[3];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t[2]=o+i*(n[2]-o),t[3]=a+i*(n[3]-a),t},xe=At,Me=xe,ye=Dt,be=ye,we=function(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n*n+i*i+r*r+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=i*o,t[2]=r*o,t[3]=s*o,t},Se=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},_e=function(t,e){var n=t[0],r=t[1],s=t[2],o=t[3],a=e[0],c=e[1],h=e[2],u=e[3];return Math.abs(n-a)<=i*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-c)<=i*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-h)<=i*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(o-u)<=i*Math.max(1,Math.abs(o),Math.abs(u))},Re=(ie=$(),re=O(1,0,0),se=O(0,1,0),function(t,e,n){var i=ht(e,n);return i<-.999999?(ut(ie,re,e),zt(ie)<1e-6&&ut(ie,se,e),ct(ie,ie),kt(t,ie,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ut(ie,e,n),t[0]=ie[0],t[1]=ie[1],t[2]=ie[2],t[3]=1+i,we(t,t))}),Ee=(oe=It(),ae=It(),function(t,e,n,i,r,s){return Kt(oe,e,r,s),Kt(ae,n,i,s),Kt(t,oe,ae,2*s*(1-s)),t}),Te=(ce=o(),function(t,e,n,i){return ce[0]=n[0],ce[3]=n[1],ce[6]=n[2],ce[1]=i[0],ce[4]=i[1],ce[7]=i[2],ce[2]=-e[0],ce[5]=-e[1],ce[8]=-e[2],we(t,te(t,ce))}),Ce={};Object.defineProperty(Ce,"__esModule",{value:!0});var Ve={};Object.defineProperty(Ve,"__esModule",{value:!0});Ve.default=class{constructor(){this._pose=null,this._view=null,this.poseMatrix=new p5.Matrix,this.initialMVMatrix=new p5.Matrix,this.leftPMatrix=new p5.Matrix,this.rightPMatrix=new p5.Matrix,this.position=new p5.Vector(0,0,0),this.setPosition=function(t,e,n){this.position.set(t,e,n),p5.instance._renderer.translate(-t,-e,-n)}}set pose(t){this._pose=t,this.poseMatrix.set(t.poseModelMatrix)}get pose(){return this._pose}set view(t){this._view=t,p5.instance._renderer.uMVMatrix.set(this._view.transform.inverse.matrix),p5.instance._renderer.uPMatrix.set(this._view.projectionMatrix),p5.instance._renderer._curCamera.cameraMatrix.set(p5.Matrix.identity().mult(this._view.transform.inverse.matrix)),"left"===t.eye?this.leftPMatrix.set(p5.instance._renderer.uPMatrix.copy()):this.rightPMatrix.set(p5.instance._renderer.uPMatrix.copy())}get view(){return this._view}},p5.prototype.setViewerPosition=function(t,e,n){const{viewer:i}=p5xr.instance;i.setPosition(t,e,n)},p5.prototype.sticky=function(t=!1){push(),p5xr.instance.viewer.drawOnTop=t,t&&p5.instance._renderer.GL.disable(p5.instance._renderer.GL.DEPTH_TEST),p5.instance._renderer.uMVMatrix.set(p5.Matrix.identity());const e=p5xr.instance.viewer.position;setViewerPosition(e.x,e.y,e.z)},p5.prototype.noSticky=function(){p5.instance._renderer.GL.enable(p5.instance._renderer.GL.DEPTH_TEST),pop()};var Pe=Ae(Ve),Le={};Object.defineProperty(Le,"__esModule",{value:!0});Le.default=class{constructor(t){this.options=t||{},this.options.color=t.color||"rgb(237, 34, 93)",this.options.background=t.background||"white",this.options.opacity=t.opacity||.95,this.options.disabledOpacity=t.disabledOpacity||.5,this.options.height=t.height||window.innerWidth/5,this.options.corners=t.corners||"square",this.options.cssprefix=t.cssprefix||"webvr-ui",this.options.textEnterXRTitle=t.textEnterXRTitle||"ENTER XR",this.options.textXRNotFoundTitle=t.textXRNotFoundTitle||"XR NOT FOUND",this.options.textExitXRTitle=t.textExitXRTitle||"EXIT XR",this.options.onRequestSession=t.onRequestSession||function(){},this.options.onEndSession=t.onEndSession||function(){},this.options.injectCSS=!1!==t.injectCSS,this.options=t,this.device=null,this.session=null,this.logoScale=1.2,this._WEBXR_UI_CSS_INJECTED={},this.domElement=t.domElement||this.createDefaultView(t),this.__defaultDisplayStyle=this.domElement.style.display||"initial",this.domElement.addEventListener("click",(()=>this.__onXRButtonClick())),this.__forceDisabled=!1,this.__setDisabledAttribute(!0),this.setTitle(this.options.textXRNotFoundTitle)}generateInnerHTML(t,e){const n=e*this.logoScale;return`<button class="${t}-button">\n    <div class="${t}-title"></div>\n    <div class="${t}-logo" >${this.generateXRIconString(t,n)+this.generateNoXRIconString(t,n)}</div>\n    </button>`}createDefaultView(t){const e=t.height/3;t.injectCSS&&(this._WEBXR_UI_CSS_INJECTED[t.cssprefix]||(this.injectCSS(this.generateCSS(t,e)),this._WEBXR_UI_CSS_INJECTED[t.cssprefix]=!0));const n=document.createElement("div");return n.innerHTML=this.generateInnerHTML(t.cssprefix,e),n.firstChild}createXRIcon(t,e){const n=document.createElement("div");return n.innerHTML=generateXRIconString(t,e),n.firstChild}createNoXRIcon(t,e){const n=document.createElement("div");return n.innerHTML=generateNoXRIconString(t,e),n.firstChild}generateXRIconString(t,e){return`<svg class="${t}-svg" version="1.1" x="0px" y="0px"\n        width="${28/18*e}px" height="${e}px" viewBox="0 0 28 18" xml:space="preserve">\n        <path d="M26.8,1.1C26.1,0.4,25.1,0,24.2,0H3.4c-1,0-1.7,0.4-2.4,1.1C0.3,1.7,0,2.7,0,3.6v10.7\n        c0,1,0.3,1.9,0.9,2.6C1.6,17.6,2.4,18,3.4,18h5c0.7,0,1.3-0.2,1.8-0.5c0.6-0.3,1-0.8,1.3-1.4l\n        1.5-2.6C13.2,13.1,13,13,14,13v0h-0.2 h0c0.3,0,0.7,0.1,0.8,0.5l1.4,2.6c0.3,0.6,0.8,1.1,1.3,\n        1.4c0.6,0.3,1.2,0.5,1.8,0.5h5c1,0,2-0.4,2.7-1.1c0.7-0.7,1.2-1.6,1.2-2.6 V3.6C28,2.7,27.5,\n        1.7,26.8,1.1z M7.4,11.8c-1.6,0-2.8-1.3-2.8-2.8c0-1.6,1.3-2.8,2.8-2.8c1.6,0,2.8,1.3,2.8,2.8\n        C10.2,10.5,8.9,11.8,7.4,11.8z M20.1,11.8c-1.6,0-2.8-1.3-2.8-2.8c0-1.6,1.3-2.8,2.8-2.8C21.7\n        ,6.2,23,7.4,23,9 C23,10.5,21.7,11.8,20.1,11.8z"/>\n    </svg>`}generateNoXRIconString(t,e){const n=28/18;return`<svg class="${t}-svg-error" x="0px" y="0px"\n        width="${n*e}px" height="${n*e}px" viewBox="0 0 28 28" xml:space="preserve">\n        <path d="M17.6,13.4c0-0.2-0.1-0.4-0.1-0.6c0-1.6,1.3-2.8,2.8-2.8s2.8,1.3,2.8,2.8s-1.3,2.8-2.8,2.8\n        c-0.2,0-0.4,0-0.6-0.1l5.9,5.9c0.5-0.2,0.9-0.4,1.3-0.8\n        c0.7-0.7,1.1-1.6,1.1-2.5V7.4c0-1-0.4-1.9-1.1-2.5c-0.7-0.7-1.6-1-2.5-1\n        H8.1 L17.6,13.4z"/>\n        <path d="M10.1,14.2c-0.5,0.9-1.4,1.4-2.4,1.4c-1.6,0-2.8-1.3-2.8-2.8c0-1.1,0.6-2,1.4-2.5\n        L0.9,5.1 C0.3,5.7,0,6.6,0,7.5v10.7c0,1,0.4,1.8,1.1,2.5c0.7,0.7,1.6,1,2.5,1\n        h5c0.7,0,1.3-0.1,1.8-0.5c0.6-0.3,1-0.8,1.3-1.4l1.3-2.6 L10.1,14.2z"/>\n        <path d="M25.5,27.5l-25-25C-0.1,2-0.1,1,0.5,0.4l0,0C1-0.1,2-0.1,2.6,0.4l25,25c0.6,0.6,0.6,1.5\n        ,0,2.1l0,0 C27,28.1,26,28.1,25.5,27.5z"/>\n    </svg>`}setDevice(t){return this.device=t,this}setSession(t){return this.session=t,this.__updateButtonState(),this}setTitle(t){return this.domElement.title=t,this.ifChild(this.domElement,this.options.cssprefix,"title",(e=>{t?(e.innerText=t,e.style.display="initial"):e.style.display="none"})),this}generateCSS(t,e=18){const{height:n}=t,i=t.background?t.background:t.color,r=t.cssprefix;let s;return s="round"==t.corners?t.height/2:"square"==t.corners?2:t.corners,`\n      @font-face {\n          font-family: 'Karla';\n          font-style: normal;\n          font-weight: 400;\n          src: local('Karla'), local('Karla-Regular'),\n              url(https://fonts.gstatic.com/s/karla/v5/31P4mP32i98D9CEnGyeX9Q.woff2) format('woff2');\n          unicode-range: U+0100-024F, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF;\n      }\n      @font-face {\n          font-family: 'Karla';\n          font-style: normal;\n          font-weight: 400;\n          src: local('Karla'), local('Karla-Regular'),\n              url(https://fonts.gstatic.com/s/karla/v5/Zi_e6rBgGqv33BWF8WTq8g.woff2) format('woff2');\n          unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074,\n                        U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;\n      }\n\n      button.${r}-button {\n          font-family: 'Karla', sans-serif;\n\n          border: ${i} 2px solid;\n          border-radius: ${s}px;\n          box-sizing: border-box;\n          background: ${t.background?t.background:"none"};\n          opacity: ${t.opacity};\n          height: ${n}px;\n          min-width: ${9.6*e}px;\n          display: inline-block;\n          position: absolute;\n          top: 5%;\n          left: 15%;\n          cursor: pointer;\n      }\n\n      button.${r}-button:focus {\n        outline: none;\n      }\n\n      /*\n      * Logo\n      */\n\n      .${r}-logo {\n          width: ${n}px;\n          height: ${n}px;\n          position: absolute;\n          top:0px;\n          left:0px;\n          width: ${n-4}px;\n          height: ${n-4}px;\n      }\n      .${r}-svg {\n          fill: ${t.color};\n          margin-top: ${(n-e*this.logoScale)/2-2}px;\n          margin-left: ${n/3}px;\n      }\n      .${r}-svg-error {\n          fill: ${t.color};\n          display:none;\n          margin-top: ${(n-28/18*e*this.logoScale)/2-2}px;\n          margin-left: ${n/3}px;\n      }\n\n\n      /*\n      * Title\n      */\n\n      .${r}-title {\n          color: ${t.color};\n          position: relative;\n          font-size: ${e}px;\n          padding-left: ${1.05*n}px;\n          padding-right: ${s-10<5?n/3:s-10}px;\n      }\n\n      /*\n      * disabled\n      */\n\n      button.${r}-button[disabled=true] {\n          opacity: ${t.disabledOpacity};\n      }\n\n      button.${r}-button[disabled=true] > .${r}-logo > .${r}-svg {\n          display:none;\n      }\n\n      button.${r}-button[disabled=true] > .${r}-logo > .${r}-svg-error {\n          display:initial;\n      }\n    `}injectCSS(t){const e=document.createElement("style");e.innerHTML=t;const n=document.getElementsByTagName("head")[0];n.insertBefore(e,n.firstChild)}ifChild(t,e,n,i){const r=t.querySelector(`.${e}-${n}`);r&&i(r)}setTooltip(t){return this.domElement.title=t,this}show(){return this.domElement.style.display=this.__defaultDisplayStyle,this}hide(){return this.domElement.style.display="none",this}enable(){return this.__setDisabledAttribute(!1),this.__forceDisabled=!1,this}disable(){return this.__setDisabledAttribute(!0),this.__forceDisabled=!0,this}remove(){this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement)}__setDisabledAttribute(t){t||this.__forceDisabled?this.domElement.setAttribute("disabled","true"):this.domElement.removeAttribute("disabled")}__onXRButtonClick(){this.session?this.options.onRequestSession(this.device):this.device&&("undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission&&DeviceMotionEvent.requestPermission().then((t=>{"granted"===t&&window.addEventListener("devicemotion",(()=>{}))})).catch(console.error),"undefined"!=typeof DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission&&DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&window.addEventListener("deviceorientation",(()=>{}))})).catch(console.error),this.options.onRequestSession(this.device))}};var ze=Ae(Le),Xe={};Object.defineProperty(Xe,"__esModule",{value:!0});Xe.default=class{constructor(t,e,i){this._inputSource=t,this._targetRayPose=e.getPose(this._inputSource.targetRaySpace,i),this._pose,this.gamepad=t.gamepad,this._dir=k.create();const r=n.create(),s=k.create();this._dir[2]=-1,this._targetRayPose&&(k.transformMat4(s,s,this._targetRayPose.transform.matrix),n.fromMat4(r,this._targetRayPose.transform.matrix),k.transformMat3(this._dir,this._dir,r)),this.direction=this._dir}get direction(){return new p5.Vector(this._dir[0],this._dir[1],this._dir[2])}set direction(t){this._dir=k.copy(this._dir,t),k.normalize(this._dir,this._dir),this.inv_dir=k.fromValues(1/this._dir[0],1/this._dir[1],1/this._dir[2]),this.sign=[this.inv_dir[0]<0?1:0,this.inv_dir[1]<0?1:0,this.inv_dir[2]<0?1:0]}get pose(){return this.updatePose(),this._pose.transform.matrix}get position(){this.updatePose();const t=this._pose?.transform?.position;return new p5.Vector(t.x,t.y,t.z)}updatePose(){this._pose=window.p5xr.instance.frame.getPose(this._inputSource.gripSpace,window.p5xr.instance.xrRefSpace)}get trigger(){return this.updateGamepad(),this.gamepad?.buttons[0]}get grip(){return this.updateGamepad(),this.gamepad.buttons[1]}get touchpad(){return this.updateGamepad(),this.gamepad.buttons[2]}get thumbstick(){return this.updateGamepad(),this.gamepad.buttons[3]}get touchpad2D(){return this.updateGamepad(),new p5.Vector(this.gamepad.axes[0],this.gamepad.axes[1])}get thumbstick2D(){return this.updateGamepad(),new p5.Vector(this.gamepad.axes[2],this.gamepad.axes[3])}updateGamepad(){this.gamepad=this._inputSource.gamepad}};var qe=Ae(Xe);function Ae(t){return t&&t.__esModule?t:{default:t}}Ce.default=class{constructor(){this.xrDevice=null,this.xrButton=null,this.isVR=null,this.hasImmersive=null,this.xrSession=null,this.xrRefSpace=null,this.xrViewerSpace=null,this.xrHitTestSource=null,this.frame=null,this.gl=null,this.curClearColor=color(255,255,255),this.viewer=new Pe.default}removeLoadingElement(){const t=document.getElementById(window._loadingScreenId);t&&t.parentNode.removeChild(t)}updateXR(){const t=p5.instance._renderer;t.ambientLightColors.length=0,t.specularColors=[1,1,1],t.directionalLightDirections.length=0,t.directionalLightDiffuseColors.length=0,t.directionalLightSpecularColors.length=0,t.pointLightPositions.length=0,t.pointLightDiffuseColors.length=0,t.pointLightSpecularColors.length=0,t.spotLightPositions.length=0,t.spotLightDirections.length=0,t.spotLightDiffuseColors.length=0,t.spotLightSpecularColors.length=0,t.spotLightAngle.length=0,t.spotLightConc.length=0,t._enableLighting=!1,t._tint=[255,255,255,255]}setupCanvas(){createCanvas(windowWidth,windowHeight,WEBGL),p5.instance._setupDone=!0}createButton(){p5.instance._incrementPreload(),this.setupCanvas(),this.removeLoadingElement(),this.xrButton=new ze.default({onRequestSession:this.onXRButtonClicked.bind(this),onEndSession:this.onSessionEnded.bind(this),textEnterXRTitle:"LOADING"});let t=document.querySelector("header");t||(t=document.createElement("header"),document.querySelector("body").appendChild(t)),t.appendChild(this.xrButton.domElement),this.sessionCheck()}sessionCheck(){navigator.xr?(console.log("XR Available"),navigator.xr.isSessionSupported("immersive-vr").then((t=>{this.hasImmersive=t})),this.isVR?(this.xrButton.setTitle("Enter VR"),this.xrButton.setTooltip("Enter VR"),this.xrButton.enable(),console.log("VR supported"),this.xrButton.setDevice(!0)):navigator.xr.isSessionSupported("immersive-ar").then((t=>{t?(this.xrButton.setTitle("Enter AR"),this.xrButton.setTooltip("Enter AR"),this.xrButton.enable(),console.log("AR supported"),this.xrButton.setDevice(!0)):(this.xrButton.setTitle("AR Not Available"),this.xrButton.setTooltip("AR Not Available"),this.xrButton.disable(),console.log("AR not supported"))}))):(console.log("XR Not Available"),this.disableButton())}onXRFrame(t,e){const n=this.xrSession=e.session;if(null===n||null===this.gl)return;n.requestAnimationFrame(this.onXRFrame.bind(this));let i=this.xrRefSpace;this.isVR&&!this.isImmersive&&(i=this.getAdjustedRefSpace(this.xrRefSpace));const r=e.getViewerPose(this.xrRefSpace),s=n.renderState.baseLayer;if(this.frame=e,r){this.viewer.pose=e.getViewerPose(i),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,s.framebuffer),this.isVR&&this.clearVR();let t=0;for(const e of this.viewer.pose.views){this.viewer.view=e;const n=this.isImmersive?1:pixelDensity(),i=s.getViewport(this.viewer.view);this.gl.viewport(i.x,i.y,i.width*n,i.height*n),this.updateViewport(i),this.drawEye(t),t++}}}updateViewport(t){p5.instance._renderer._viewport[0]=t.x,p5.instance._renderer._viewport[1]=t.y,p5.instance._renderer._viewport[2]=t.width,p5.instance._renderer._viewport[3]=t.height}drawEye(t){const e=window,n=e.setup,i=e.draw,r=e.calculate;if(this.isVR){if(0===t){"function"==typeof r&&r();const t=window.performance.now();p5.instance.deltaTime=t-p5.instance._lastFrameTime,p5.instance._frameRate=1e3/p5.instance.deltaTime,p5.instance._setProperty("deltaTime",p5.instance.deltaTime),p5.instance._lastFrameTime=t,e._setProperty("frameCount",e.frameCount+1)}}else scale(.01);if(p5.instance._renderer.isP3D){if("function"==typeof i){void 0===n&&e.scale(e._pixelDensity,e._pixelDensity),this.updateXR(),p5.instance._inUserDraw=!0;try{i()}finally{p5.instance._inUserDraw=!1}}}else console.error("Sketch does not have 3D Renderer")}getXRInput(t){let e;return this.xrSession.inputSources.forEach((n=>{n.handedness===t&&(e=new qe.default(n,this.frame,this.xrRefSpace))})),e}onSessionEnded(){this.isVR?this.isImmersive&&(console.log("Exiting immersive session"),this.isImmersive=!1,this.sessionCheck(),console.log("Requesting new session"),navigator.xr.requestSession("inline").then(this.startSketch.bind(this))):(this.xrHitTestSource.cancel(),this.xrHitTestSource=null),this.isImmersive&&this.hasImmersive&&(this.isImmersive=!1)}printUnsupportedMessage(){console.warn("Your browser/hardware does not work with AR Mode currently. This is undergoing heavy development currently.You may be able to fix this by enabling WebXR flags in Chrome.")}remove(){this.xrButton&&this.xrButton.remove(),window.p5xr.instance=null}get instance(){return window.p5xr.instance}set instance(t){return window.p5xr.instance=t,window.p5xr.instance}};var De,Ie=(De=Ce)&&De.__esModule?De:{default:De};class Fe extends Ie.default{constructor(){super(),this.isVR=!0,this.isImmersive=!1,this.lookYaw=0,this.lookPitch=0,this.LOOK_SPEED=.0025,this.primaryTouch=void 0,this.prevTouchX=void 0,this.prevTouchY=void 0,navigator.xr.requestSession("inline").then(this.startSketch.bind(this))}initVR(){this.createButton()}startSketch(t){this.xrSession=t,this.canvas=p5.instance.canvas,this.canvas.style.visibility="visible",this.xrSession.addEventListener("end",this.onSessionEnded.bind(this)),"function"==typeof window.setup&&(window.setup(),p5.instance._millisStart=window.performance.now());const e=this.isImmersive?"local":"viewer";this.xrSession.requestReferenceSpace(e).then((t=>{this.xrRefSpace=t,this.xrSession.requestAnimationFrame(this.onXRFrame.bind(this)),this.isImmersive||(this.xrSession.updateRenderState({baseLayer:new XRWebGLLayer(this.xrSession,this.gl),inlineVerticalFieldOfView:Math.PI/180*90}),this.addInlineViewListeners(this.canvas))})),this.onRequestSession()}resetXR(){this.xrDevice=null,this.xrSession=null,this.xrRefSpace=null,this.xrViewerSpace=null,this.xrHitTestSource=null,this.gl=null,this.frame=null}onXRButtonClicked(){this.hasImmersive?(console.log("Requesting session with mode: immersive-vr"),this.isImmersive=!0,this.resetXR(),navigator.xr.requestSession("immersive-vr").then(this.startSketch.bind(this))):this.xrButton.hide()}onRequestSession(){p5.instance._renderer._curCamera.cameraType="custom";const t=this.isImmersive?"local":"viewer";this.gl=this.canvas.getContext("webgl"),this.gl.makeXRCompatible().then((()=>{this.xrSession.requestReferenceSpace(t).then((t=>{this.xrRefSpace=t})),this.xrSession.updateRenderState({baseLayer:new XRWebGLLayer(this.xrSession,this.gl)})})).catch((t=>{console.log(t)})),this.xrSession.requestAnimationFrame(this.onXRFrame.bind(this))}setupBaseLayer(){this.baseLayer=new XRWebGLLayer(this.xrSession,this.gl),this.xrSession.updateRenderState({baseLayer:this.baseLayer})}clearVR(){null!==this.curClearColor&&(p5.instance.background(this.curClearColor),this.gl.clear(this.gl.DEPTH_BUFFER_BIT))}getAdjustedRefSpace(t){const e=F.create();F.rotateX(e,e,-this.lookPitch),F.rotateY(e,e,-this.lookYaw);const n=new XRRigidTransform({x:0,y:0,z:0},{x:e[0],y:e[1],z:e[2],w:e[3]});return t.getOffsetReferenceSpace(n)}rotateView(t,e){this.lookYaw+=t*this.LOOK_SPEED,this.lookPitch+=e*this.LOOK_SPEED,this.lookPitch<.5*-Math.PI&&(this.lookPitch=.5*-Math.PI),this.lookPitch>.5*Math.PI&&(this.lookPitch=.5*Math.PI)}addInlineViewListeners(t){this.canvas.addEventListener("mousemove",(t=>{t.buttons&&this.rotateView(t.movementX,t.movementY)})),this.canvas.addEventListener("touchstart",(t=>{if(void 0===this.primaryTouch){const e=t.changedTouches[0];this.primaryTouch=e.identifier,this.prevTouchX=e.pageX,this.prevTouchY=e.pageY}})),t.addEventListener("touchend",(t=>{for(const e of t.changedTouches)this.primaryTouch===e.identifier&&(this.primaryTouch=void 0,this.rotateView(e.pageX-this.prevTouchX,e.pageY-this.prevTouchY))})),t.addEventListener("touchcancel",(t=>{for(const e of t.changedTouches)this.primaryTouch===e.identifier&&(this.primaryTouch=void 0)})),t.addEventListener("touchmove",(t=>{for(const e of t.changedTouches)this.primaryTouch===e.identifier&&(this.rotateView(e.pageX-this.prevTouchX,e.pageY-this.prevTouchY),this.prevTouchX=e.pageX,this.prevTouchY=e.pageY)}))}}e.default=Fe;var ke=Ne(e),$e={};Object.defineProperty($e,"__esModule",{value:!0});var Be=He(Ce),Ue={};Object.defineProperty(Ue,"__esModule",{value:!0});Ue.default=class{constructor(t,e,n){this.position={x:100*t,y:100*e,z:100*n}}dispose(){}isTracking(){}isStopped(){}transform(){translate(this.position.x,this.position.y,this.position.z)}};var Oe=He(Ue);function He(t){return t&&t.__esModule?t:{default:t}}class Ge extends Be.default{constructor(){super(),this.canvas=null}initAR(){this.createButton(),navigator.xr&&this.sessionCheck()}startSketch(t){this.xrSession=this.xrButton.session=t,this.xrSession.addEventListener("end",this.onSessionEnded),"function"==typeof touchStarted&&this.xrSession.addEventListener("select",touchStarted),this.canvas=p5.instance.canvas,p5.instance._renderer._curCamera.cameraType="custom",this.onRequestSession(),p5.instance._decrementPreload()}onSelect(t){const e=window.mousePressed;"function"==typeof e&&e()}detectHit(t){if(null==t)return console.warn("You must pass the touchStarted event to detectHit."),null;if(!this.xrSession)return null;t.clientY,window.innerHeight,t.clientX,window.innerWidth;if(this.xrHitTestSource&&this.viewer.pose&&this.frame){const t=this.frame.getHitTestResults(this.xrHitTestSource);if(t.length>0){const e=t[0].getPose(this.xrRefSpace);return createVector(e.transform.position.x,e.transform.position.y,e.transform.position.z)}}}createAnchor(t){return null==t?null:new Oe.default(t.x,t.y,t.z)}onXRButtonClicked(t){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.xr.requestSession("immersive-ar",{requiredFeatures:["local","hit-test"]}).then((t=>{this.startSketch(t)}),(t=>{console.log(`${t} unable to request an immersive-ar session.`)}))}onRequestSession(){this.gl=this.canvas.getContext("webgl",{xrCompatible:!0}),this.gl.makeXRCompatible().then((()=>{this.xrSession.updateRenderState({baseLayer:new XRWebGLLayer(this.xrSession,this.gl)})})),this.xrSession.requestReferenceSpace("viewer").then((t=>{this.xrViewerSpace=t,this.xrSession.requestHitTestSource({space:this.xrViewerSpace}).then((t=>{this.xrHitTestSource=t}))})),this.xrSession.requestReferenceSpace("local").then((t=>{this.xrRefSpace=t,this.xrSession.requestAnimationFrame(this.onXRFrame.bind(this))}))}}$e.default=Ge;var Ye=Ne($e),je=function(t){return t&&t.__esModule?t:{default:t}}(Ve);function Ne(t){return t&&t.__esModule?t:{default:t}}je.default.prototype.getRayFromScreen=function(t,e){const n={origin:new p5.Vector(0,0,0),direction:new p5.Vector};let i=this.poseMatrix.copy();i.transpose(i),i=i.mat4,n.origin.x=i[3],n.origin.y=i[7],n.origin.z=i[11];let r=this.initialMVMatrix.copy();r.transpose(r),r=r.mat4;const s=n.origin.copy();n.origin.x=r[0]*s.x+r[1]*s.y+r[2]*s.z+r[3],n.origin.y=r[4]*s.x+r[5]*s.y+r[6]*s.z+r[7],n.origin.z=r[8]*s.x+r[9]*s.y+r[10]*s.z+r[11];const o=new p5.Vector(t,e,-1);let a=new p5.Matrix;a.invert(this.leftPMatrix.copy()),a.transpose(a),a=a.mat4;const c=o.copy();o.x=a[0]*c.x+a[1]*c.y+a[2]*c.z,o.y=a[4]*c.x+a[5]*c.y+a[6]*c.z,o.normalize();const h=new p5.Vector(t,e,-1);let u=new p5.Matrix;u.invert(this.rightPMatrix.copy()),u.transpose(u),u=u.mat4;const l=h.copy();return h.x=u[0]*l.x+u[1]*l.y+u[2]*l.z,h.y=u[4]*l.x+u[5]*l.y+u[6]*l.z,h.normalize(),n.direction=p5.Vector.add(o,h).normalize(),n},p5.prototype.intersectsSphere=function(){const t=arguments[0];let e={origin:null,direction:null};if(2===arguments.length&&arguments[1].hasOwnProperty("origin"))e.origin=arguments[1].origin.copy(),e.direction=arguments[1].direction.copy();else{const t=arguments[1]||0,n=arguments[2]||0;e=p5xr.instance.viewer.getRayFromScreen(t,n)}if(null===e)return!1;let n=p5.instance._renderer.uMVMatrix.copy();n.transpose(n),n=n.mat4;const i=new p5.Vector(0,0,0);if(i.x=n[3],i.y=n[7],i.z=n[11],p5.Vector.sub(e.origin,i).mag()<=t)return!0;if(p5.Vector.dot(p5.Vector.sub(i,e.origin),e.direction)<0)return!1;const r=p5.Vector.sub(e.origin,i),s=2*p5.Vector.dot(e.direction,r),o=p5.Vector.mag(r)*p5.Vector.mag(r)-t*t,a=s*s-4*o;return a>=0},p5.prototype.intersectsBox=function(){const t=arguments[0];let e,n,i={origin:null,direction:null};arguments[arguments.length-1].hasOwnProperty("origin")?(i.origin=arguments[arguments.length-1].origin.copy(),i.direction=arguments[arguments.length-1].direction.copy(),e=arguments.length>2?arguments[1]:t,n=arguments.length>3?arguments[2]:e):5===arguments.length?(i=p5xr.instance.viewer.getRayFromScreen(arguments[3],arguments[4]),e=arguments[1],n=arguments[2]):(i=p5xr.instance.viewer.getRayFromScreen(0,0),e=arguments.length>1?arguments[1]:t,n=arguments.length>2?arguments[2]:e);let r=p5.instance._renderer.uMVMatrix.copy();r.transpose(r),r.invert(r),r=r.mat4;const s=i.origin.copy();i.origin.x=r[0]*s.x+r[1]*s.y+r[2]*s.z+r[3],i.origin.y=r[4]*s.x+r[5]*s.y+r[6]*s.z+r[7],i.origin.z=r[8]*s.x+r[9]*s.y+r[10]*s.z+r[11];const o=i.direction.copy();i.direction.x=r[0]*o.x+r[1]*o.y+r[2]*o.z,i.direction.y=r[4]*o.x+r[5]*o.y+r[6]*o.z,i.direction.z=r[8]*o.x+r[9]*o.y+r[10]*o.z,i.direction.normalize();const a=new p5.Vector(-.5*t,-.5*e,-.5*n),c=new p5.Vector(.5*t,.5*e,.5*n),h=(a.x-i.origin.x)/i.direction.x,u=(c.x-i.origin.x)/i.direction.x,l=(a.y-i.origin.y)/i.direction.y,p=(c.y-i.origin.y)/i.direction.y,d=(a.z-i.origin.z)/i.direction.z,f=(c.z-i.origin.z)/i.direction.z,m=Math.max(Math.max(Math.min(h,u),Math.min(l,p)),Math.min(d,f)),g=Math.min(Math.min(Math.max(h,u),Math.max(l,p)),Math.max(d,f));return!(g<0||m>g)},p5.prototype.intersectsPlane=function(){let t={origin:null,direction:null};arguments[0].hasOwnProperty("origin")?(t.origin=arguments[0].origin.copy(),t.direction=arguments[0].direction.copy()):t=p5xr.instance.viewer.getRayFromScreen(arguments[0],arguments[1]);let e=p5.instance._renderer.uMVMatrix.copy();e.transpose(e),e.invert(e),e=e.mat4;const n=t.origin.copy();t.origin.x=e[0]*n.x+e[1]*n.y+e[2]*n.z+e[3],t.origin.y=e[4]*n.x+e[5]*n.y+e[6]*n.z+e[7],t.origin.z=e[8]*n.x+e[9]*n.y+e[10]*n.z+e[11];const i=t.direction.copy();t.direction.x=e[0]*i.x+e[1]*i.y+e[2]*i.z,t.direction.y=e[4]*i.x+e[5]*i.y+e[6]*i.z,t.direction.z=e[8]*i.x+e[9]*i.y+e[10]*i.z,t.direction.normalize();const r=new p5.Vector(0,0,1),s=new p5.Vector(0,0,0),o=p5.Vector.sub(s,t.origin),a=Math.abs(p5.Vector.dot(t.direction,r));if(0===a)return null;const c=Math.abs(p5.Vector.dot(o,r)/a),h=p5.Vector.add(t.origin,t.direction.copy().setMag(c));return createVector(h.x,h.y)},p5.prototype.generateRay=function(t,e,n,i,r,s){const o=new p5.Vector(t,e,n);let a=new p5.Vector(i,r,s);a=p5.Vector.sub(a,o),a.normalize();let c=p5.instance._renderer.uMVMatrix.copy();c.transpose(c),c=c.mat4;const h=o.copy();o.x=c[0]*h.x+c[1]*h.y+c[2]*h.z+c[3],o.y=c[4]*h.x+c[5]*h.y+c[6]*h.z+c[7],o.z=c[8]*h.x+c[9]*h.y+c[10]*h.z+c[11];const u=a.copy();return a.x=c[0]*u.x+c[1]*u.y+c[2]*u.z,a.y=c[4]*u.x+c[5]*u.y+c[6]*u.z,a.z=c[8]*u.x+c[9]*u.y+c[10]*u.z,a.normalize(),{origin:o,direction:a}},window.p5xr={instance:null},p5.prototype.createVRCanvas=function(){noLoop(),p5xr.instance=new ke.default,p5xr.instance.initVR()},p5.prototype.createARCanvas=function(){noLoop(),p5xr.instance=new Ye.default,p5xr.instance.initAR()},p5.prototype.setVRBackgroundColor=function(t,e,n){p5xr.instance.curClearColor=color(t,e,n)},p5.prototype.surroundTexture=function(t){push(),texture(t),rotateX(PI),scale(-1,1,1),sphere(300,60,40),pop()},p5.prototype.createAnchor=function(t){if(!p5xr.instance.isVR)return p5xr.instance.createAnchor(t)},p5.prototype.detectHit=function(t){if(!p5xr.instance.isVR)return p5xr.instance.detectHit(t)},p5.prototype.getXRInput=function(t){if(0!==p5xr.instance.xrSession.inputSources.length)return p5xr.instance.getXRInput(t)}})();